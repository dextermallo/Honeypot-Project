package main

import (
	"fmt"
	"io/ioutil"
	"log"
	"net/http"
	"os/exec"
	"strings"
)

func main() {
	http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
		if r.Method == "GET" && r.URL.Path == "/" {
			fmt.Fprint(w, "<html><body><h1>Welcome to the vulnerable server!</h1></body></html>")
		} else {
			http.NotFound(w, r)
		}
	})

	http.HandleFunc("/execute", func(w http.ResponseWriter, r *http.Request) {
		if r.Method == "POST" && r.URL.Path == "/execute" {
			body, err := ioutil.ReadAll(r.Body)
			if err != nil {
				http.Error(w, "Error reading request body", http.StatusInternalServerError)
				return
			}
			command := strings.TrimSpace(string(body))

			output, err := exec.Command("sh", "-c", command).CombinedOutput()
			if err != nil {
				http.Error(w, "Error executing command", http.StatusInternalServerError)
				return
			}

			w.Header().Set("Content-Type", "text/plain")
			fmt.Fprintf(w, "%s", output)
		} else {
			http.NotFound(w, r)
		}
	})

	fmt.Println("Starting the server at http://localhost:80")
	log.Fatal(http.ListenAndServe(":80", nil))
}
